Which interests have been present in all month_year dates in our dataset?

SELECT mp.interest_name, COUNT(met.month_year) AS present_mths 
FROM fresh_segments.interest_metrics met
JOIN fresh_segments.interest_map mp
ON met.interest_id::INT = mp.id
WHERE met._month IS NOT NULL
AND met._year IS NOT NULL
GROUP BY 1
HAVING COUNT(met.month_year) >= (SELECT COUNT(DISTINCT month_year) FROM fresh_segments.interest_metrics)
ORDER BY 2 DESC;

/*
interest_name	present_mths
Pizza Lovers	18
*/

Using this same total_months measure - calculate the cumulative percentage of all records starting at 14 months - which total_months value passes the 90% cumulative percentage value?

-- First, count the records of months for each interest

WITH id_cte AS (
SELECT mt.interest_id, COUNT(mt.month_year) AS total_months
FROM fresh_segments.interest_metrics mt
JOIN fresh_segments.interest_map mp
ON mt.interest_id::INT = mp.id
WHERE mt._month IS NOT NULL 
GROUP BY 1
), 
-- second, count the records of interests for the total months to accumulate
mth_cte AS (
SELECT total_months, COUNT(DISTINCT interest_id) AS interest_count
FROM id_cte
GROUP BY 1
)
SELECT total_months, interest_count,
ROUND(100 * SUM(interest_count) OVER(ORDER BY total_months DESC) / SUM(interest_count) OVER(), 2) AS cumulative_pct
FROM mth_cte;


/* 
total_months	interest_count	cumulative_pct
14	480	39.93
13	82	46.76
12	65	52.16
11	94	59.98
10	86	67.14
9	95	75.04
8	67	80.62
7	90	88.10
6	33	90.85
5	38	94.01
4	32	96.67
3	15	97.92
2	12	98.92
1	13	100.00
*/

-- month 6 of the total months passes the 90% cumulative value

If we were to remove all interest_id values which are lower than the total_months value we found in the previous question - how many total data points would we be removing?

-- Step 1. Create an expression that collects all the interest where total_months present is 5 or less (below cumulative 90%)

WITH discard_cte AS (SELECT mt.interest_id, COUNT(DISTINCT mt.month_year) AS total_months
FROM fresh_segments.interest_metrics mt
JOIN fresh_segments.interest_map mp
ON mt.interest_id::INT = mp.id
WHERE mt._month IS NOT NULL
AND mt._month IS NOT NULL
GROUP BY 1
HAVING COUNT(DISTINCT mt.month_year) < 6)

-- Step 2. Count the data rows of these id's

SELECT COUNT(*) AS records_to_remove
FROM fresh_segments.interest_metrics met
RIGHT JOIN discard_cte disc
ON met.interest_id = disc.interest_id; 

-- 400 rows to remove

Does this decision make sense to remove these data points from a business perspective? Use an example where there are all 14 months present to a removed interest example for your arguments - think about what it means to have less months present from a segment perspective.
After removing these interests - how many unique interests are there for each month?
